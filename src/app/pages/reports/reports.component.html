<div style="padding: 20px;">
<div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px; flex-wrap: wrap;">
  <!-- æ—¥æœŸé€‰æ‹©å™¨ -->
  <p-datepicker
    selectionMode="range"
    [(ngModel)]="date"
    [readonlyInput]="true"
    (onSelect)="fetchData()"
  ></p-datepicker>

  <!-- äº§å“åè¾“å…¥ + æœç´¢æŒ‰é’® -->
  <div style="display: flex; align-items: center; gap: 5px; flex: 1;">
    <input 
      class="form-control" 
      placeholder="äº§å“å" 
      [(ngModel)]="filter.productCode" 
      name="productCode" 
      style="height: 38px; flex: 1; padding: 0 10px;"
    />
    <button class="btn btn-primary" (click)="fetchData()" style="height: 38px;">æœç´¢</button>
  </div>
</div>
  <!-- Group By æŒ‰é’®ç»„ -->
  <p-selectbutton
    [options]="groupOption"
    optionLabel="name" optionValue="id"
    (onChange)="setGroupBy($event.value)"
  ></p-selectbutton>

  <!-- è¡¨æ ¼ -->
  <p-table [value]="groupedData" [loading]="loading" class="p-mt-3" 
  scrollHeight="500px" >
    <ng-template pTemplate="header">
      <tr>
        <th *ngIf="groupBy === 'product' || groupBy === 'material' || groupBy === 'color'">äº§å“</th>
        <th *ngIf="groupBy === 'material' || groupBy === 'color'">å¸ƒæ–™</th>
        <th *ngIf="groupBy === 'color'">é¢œè‰²</th>
        <th>æ•°é‡</th>
        <th *ngIf="groupBy === 'color'">å›¾ç‰‡</th>
      </tr>
    </ng-template>
    <ng-template pTemplate="body" let-item>
      <tr>
        <td *ngIf="groupBy === 'product' || groupBy === 'material' || groupBy === 'color'">
          {{ item.productName }}
        </td>
        <td *ngIf="groupBy === 'material' || groupBy === 'color'">
          {{ item.materialName }}
        </td>
        <td *ngIf="groupBy === 'color'">
          {{ item.colorName }}
        </td>
        <td>{{ item.amount }}</td>
        <td *ngIf="groupBy === 'color'">
          <img *ngIf="item.colorImg" [src]="item.colorImg" alt="color" width="30" height="30" style="cursor:pointer" (click)="openImage(item.colorImg)"/>
          
        </td>
      </tr>
    </ng-template>
  </p-table>

  <!-- å›¾è¡¨ -->
  <div echarts [options]="chartOptions" style="height: 400px; margin-top: 20px;"></div>
</div>

<!-- ğŸ”¹ å¤§å›¾é¢„è§ˆ Modal -->
<div class="image-modal" *ngIf="previewImage" (click)="closeImage()">
    <img [src]="previewImage" class="modal-img">
</div>